#!/usr/bin/env python3

import sys
import time
import os
from termcolor import colored, cprint

from modulesROS1 import scanner
from modulesROS1 import analyser
from modulesROS1 import exploiter


def titel():
    cprint("_______________________    __________              ______     __________\n"
           "___  __ \_  __ \_  ___/    ___  ____/___  ____________  /________(_)_  /_____________\n"
           "__  /_/ /  / / /____ \     __  __/  __  |/_/__  __ \_  /_  __ \_  /_  __/  _ \_  ___/\n"
           "_  _, _// /_/ /____/ /     _  /___  __>  < __  /_/ /  / / /_/ /  / / /_ /  __/  /\n"
           "/_/ |_| \____/ /____/      /_____/  /_/|_| _  .___//_/  \____//_/  \__/ \___//_/\n"
           "                                           /_/                                     ",
           'blue', attrs=['bold'])


def main():
    """ main function for merging the program functionalities """

    master_hosts = []

    while True:
        while True:
            titel()
            cprint("MAIN MENU:", 'white', attrs=['bold'])
            cprint("[1] Scan LAN for systems running ROS1\n"
                   "[2] Exit\n", 'white')

            try:
                option = int(input(colored("\rSelect option: ", 'white')))

                print()
                if option == 1:
                    os.system('clear')
                    scan = scanner.ROSScanner()
                    results = scan.scanControllerROS1()
                    master_hosts += results
                    print()
                    break

                elif option == 2:
                    sys.exit("[!] Shutting down ROS Exploiter")

                else:
                    sys.stdout.write(colored("\r[!] Invalid input", 'red'))
                    time.sleep(1.5)
                    os.system('clear')
            except ValueError:
                sys.stdout.write(colored("\r[!] Invalid input", 'red'))
                time.sleep(1.5)
                os.system('clear')


        if len(master_hosts) > 0: # TODO extra functie voor Topic enumeration
            while True:
                cprint("RECONNAISSANCE & EXPLOITATION MENU:", 'white', attrs=['bold'])
                cprint("[1] [RECON] Gather information about found ROS system(s)\n"
                       "[2] [RECON] Check ROS system(s) for vulnerable topics and message types\n"
                       "[3] [EXPLN] Shutdown single node (process) on target system\n"
                       "[4] [EXPLN] DoS attack against internal ROS network\n"
                       "[5] [EXPLN] ACI attack against target system (ROS1 must be installed)\n"
                       "[6] [EXPLN] MITM attack for hijacking robot RC (ROS1 must be installed)\n"
                       "[7] Back to main menu\n"
                       "[8] Exit\n", 'white')

                try:
                    option = int(input(colored("Select option: ", 'white')))
                    if option == 1:
                        os.system('clear')
                        analyse = analyser.ROSAnalyser(master_hosts)
                        analyse.systemRecon()
                        print()

                    elif option == 2:
                        os.system('clear')
                        analyse = analyser.ROSAnalyser(master_hosts)
                        analyse.topicRecon()
                        print()

                    elif option == 3:
                        os.system('clear')
                        exploit1 = exploiter.SingleShutdown(master_hosts)
                        exploit1.invokeShutdown()
                        print()

                    elif option == 4:
                        os.system('clear')
                        exploit2 = exploiter.DoSAttack(master_hosts)
                        exploit2.invokeDoS()
                        print()

                    elif option == 5:
                        os.system('clear')
                        exploit3 = exploiter.ACIAttack(master_hosts)
                        exploit3.invokeACI()
                        print()

                    elif option == 6:
                        os.system('clear')
                        exploit4 = exploiter.MITMAttack(master_hosts)
                        exploit4.invokeMITM()
                        print()

                    elif option == 7:
                        master_hosts = []
                        os.system('clear')
                        break

                    elif option == 8:
                        sys.exit("[!] Shutting down ROS Exploiter")

                    else:
                        sys.stdout.write(colored("\r[!] Invalid input", 'red'))
                        time.sleep(1.5)
                        os.system('clear')
                except ValueError:
                    sys.stdout.write(colored("\r[!] Invalid input", 'red'))
                    time.sleep(1.5)
                    os.system('clear')

        else:
            sys.exit("[!] Shutting down ROS Exploiter")


if __name__ == '__main__':
    main()






















